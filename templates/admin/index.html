{% extends 'layout.html' %}

{% block title %}
    <title>SmartPark Admin Dashboard</title>
{% endblock %}

{% block style %}

    <style>
        body {
            background: #0c1a27;
            font-family: 'Inter', sans-serif;
            color: #e8eaf6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .admin-navbar {
            background: rgb(2, 8, 31);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0; z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .navbar-brand {
            font-size: 1.8rem; font-weight: 700;
            background: linear-gradient(45deg, #efeff1, #14314a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .nav-link {
            color: #c5cae9 !important; font-weight: 500;
            margin: 0 0.5rem; transition: all 0.3s;
            border-radius: 10px; padding: 0.5rem 1rem !important;
        }
        .nav-link:hover { color: #fff !important; background: rgba(255,255,255,0.1); transform: translateY(-2px);}
        .nav-link.active { background: linear-gradient(45deg, #162635, #3d576b);; color: #000 !important; font-weight: 600;}
        .dashboard-header {
            background: rgba(4, 1, 26, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            margin: 2rem auto;
            max-width: 1200px;
            padding: 2rem;
            box-shadow: 0 2px 1px rgba(92, 96, 120, 0.3), 0 0 0 1px rgba(255,255,255,0.1);
            animation: slideInFromTop 0.8s ease-out;
        }
        @keyframes slideInFromTop {
            0% { transform: translateY(-50px); opacity: 0;}
            100% { transform: translateY(0); opacity: 1;}
        }
        .admin-profile {
            display: flex; align-items: center; gap: 1.5rem; margin-bottom: 2rem;
        }
        .profile-avatar {
            width: 100px; height: 100px; border-radius: 50%;
            background: linear-gradient(45deg, #081928, #2d475d);
            display: flex; align-items: center; justify-content: center;
            animation: avatarPulse 3s ease-in-out infinite;
            box-shadow: 0px 5px 5px #171819;
        }

        .profile-avatar i { font-size: 2.5rem; color: #000;}
        .admin-info h2 { font-weight: 600; margin-bottom: 0.5rem; color: #c6c9ca;}
        .admin-info p { color: #c5cae9; display: flex; align-items: center; gap: 0.5rem;}
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem; margin: 2rem 0;
        }
        .stat-card {
            background: rgb(0, 4, 8);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
            animation: fadeInUp 0.6s;
        }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 15px 10px rgba(47, 51, 66, 0.3);}
        @keyframes fadeInUp { 0% { transform: translateY(30px); opacity: 0;} 100% { transform: translateY(0); opacity: 1;}}
        .stat-icon { font-size: 2.5rem; margin-bottom: 1rem; animation: iconFloat 3s ease-in-out infinite;}
        .stat-icon.users { color: #235166;}
        .stat-icon.lots { color: #235166;}
        .stat-icon.spots { color: #235166;}
        .stat-icon.active { color: #235166;}
        @keyframes iconFloat { 0%,100% { transform: translateY(0px);} 50% { transform: translateY(-8px);}}
        .stat-value { font-size: 2rem; font-weight: 700; color: #e8eaf6; margin: 0.5rem 0;}
        .stat-label { color: #9fa8da; font-size: 1rem;}
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px,1fr));
            gap: 1.5rem; margin: 3rem 0;
        }
        .action-btn {
            background: linear-gradient(45deg, #0f132a, #07243b);
            border: none; border-radius: 20px; color: rgb(135, 156, 158);
            padding: 2rem 1.5rem; font-weight: 600;
            display: flex; flex-direction: column; align-items: center; text-align: center; gap: 1rem;
            transition: all 0.3s; 
            animation: fadeInUp 0.6s; text-decoration: none; position: relative; overflow: hidden;
        }
        .action-btn:hover { transform: translateY(-5px); box-shadow: 0 2px 2px rgba(186, 186, 187, 0.4);}
        .action-btn i { font-size: 2.5rem;}
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 300px;
            margin: 0 auto 2rem auto;
            background: rgba(22, 24, 43, 0.6);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255,255,255,0.1);
        }
        @media (max-width: 700px) {
            .chart-container { max-width: 100%; height: 220px;}
        }
        .chart-title { color: #c5cae9; font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; text-align: center;}
        .charts-section { margin: 3rem 0;}
        .activity-feed {
            background: rgba(0, 2, 24, 0.6);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255,255,255,0.1);
            margin-top: 2rem;
        }
        .activity-item { display: flex; align-items: center; gap: 1rem; padding: 1rem 0; border-bottom: 1px solid rgba(255,255,255,0.1);}
        .activity-item:last-child { border-bottom: none;}
        .activity-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1rem;}
        .activity-icon.success { background: rgba(76, 175, 80, 0.2); color: #4caf50;}
        .activity-icon.warning { background: rgba(255, 152, 0, 0.2); color: #ff9800;}
        .activity-icon.info { background: rgba(33, 150, 243, 0.2); color: #2196f3;}
        .activity-content { flex: 1;}
        .activity-title { color: #e8eaf6; font-weight: 500; margin-bottom: 0.25rem;}
        .activity-time { color: #9fa8da; font-size: 0.875rem;}
        @media (max-width: 768px) {
            .dashboard-header { margin: 1rem; padding: 1.5rem;}
            .admin-profile { flex-direction: column; text-align: center;}
            .action-buttons, .stats-container { grid-template-columns: 1fr;}
            .charts-section { padding: 0 1rem;}
        }


    </style>
{% endblock %}

{% block content %}

    <!-- Admin Navigation -->
    <nav class="navbar navbar-expand-lg admin-navbar">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('admin.index') }}">
                <i class="fas fa-shield-alt me-2"></i>SmartPark Admin
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#adminNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="adminNavbar">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="{{ url_for('admin.index') }}">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin.view_lots') }}">
                            <i class="fas fa-building me-1"></i>Lots
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin.view_spots') }}">
                            <i class="fas fa-parking me-1"></i>Spots
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin.manage_users') }}">
                            <i class="fas fa-users me-1"></i>Users
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin.view_reservations') }}">
                            <i class="fas fa-calendar-check me-1"></i>Reservations
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin.summary') }}">
                            <i class="fas fa-chart-bar me-1"></i>Summary
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('auth.logout') }}">
                            <i class="fas fa-sign-out-alt me-1"></i>Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="admin-profile">
            <div class="profile-avatar">
                <i class="fas fa-user-shield"></i>
            </div>
            <div class="admin-info">
                <h2>Hello, Admin!</h2>
                <p><i class="fas fa-calendar"></i> {{ datetime.now().strftime('%B %d, %Y') }}</p>
                <p><i class="fas fa-clock"></i> {{ datetime.now().strftime('%I:%M %p') }}</p>
                <p><i class="fas fa-shield-check"></i> System Administrator</p>
            </div>
        </div>
        <div class="stats-container">
            <div class="stat-card" style="animation-delay: 0.1s;">
                <div class="stat-icon users"><i class="fas fa-users"></i></div>
                <div class="stat-value">{{ stats.total_users }}</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card" style="animation-delay: 0.2s;">
                <div class="stat-icon lots"><i class="fas fa-building"></i></div>
                <div class="stat-value">{{ stats.total_lots }}</div>
                <div class="stat-label">Parking Lots</div>
            </div>
            <div class="stat-card" style="animation-delay: 0.3s;">
                <div class="stat-icon spots"><i class="fas fa-parking"></i></div>
                <div class="stat-value">{{ stats.total_spots }}</div>
                <div class="stat-label">Parking Spots</div>
            </div>
            <div class="stat-card" style="animation-delay: 0.4s;">
                <div class="stat-icon active"><i class="fas fa-car"></i></div>
                <div class="stat-value">{{ stats.active_reservations }}</div>
                <div class="stat-label">Active Bookings</div>
            </div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div class="container" style="max-width: 1200px;">
        <!-- Action Buttons -->
        <div class="action-buttons">
            <a href="{{ url_for('admin.view_lots') }}" class="action-btn manage-lots" style="animation-delay: 0.1s; text-decoration: none;">
                <i class="fas fa-building"></i>
                <span>Manage Parking Lots</span>
                <small>Add, Edit, Delete Lots</small>
            </a>
            <a href="{{ url_for('admin.view_spots') }}" class="action-btn manage-spots" style="animation-delay: 0.2s; text-decoration: none;">
                <i class="fas fa-parking"></i>
                <span>Manage Parking Spots</span>
                <small>Control Spot Availability</small>
            </a>
            <a href="{{ url_for('admin.manage_users') }}" class="action-btn manage-users" style="animation-delay: 0.3s; text-decoration: none;">
                <i class="fas fa-users"></i>
                <span>Manage Users</span>
                <small>View & Control Users</small>
            </a>
            <a href="{{ url_for('admin.view_reservations') }}" class="action-btn reservations" style="animation-delay: 0.4s; text-decoration: none;">
                <i class="fas fa-calendar-check"></i>
                <span>View Reservations</span>
                <small>Track All Bookings</small>
            </a>
        
            <a href="{{ url_for('admin.summary') }}" class="action-btn view-summary" style="animation-delay: 0.6s; text-decoration: none;">
                <i class="fas fa-chart-pie"></i>
                <span>Dashboard Summary</span>
                <small>Analytics & Reports</small>
            </a>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="row">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h3 class="chart-title">
                            <i class="fas fa-chart-bar me-2"></i>
                            Bookings by Parking Lot
                        </h3>
                        <canvas id="lotBookingsChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h3 class="chart-title">
                            <i class="fas fa-chart-pie me-2"></i>
                            Spot Status Overview
                        </h3>
                        <canvas id="spotStatusChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <h3 class="chart-title">
                    <i class="fas fa-chart-line me-2"></i>
                    Revenue Trends (Last 7 Days)
                </h3>
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <!-- Recent Activity Feed -->
        <div class="activity-feed">
            <h3 class="chart-title">
                <i class="fas fa-clock me-2"></i>
                Recent System Activity
            </h3>
            {% if recent_activities %}
                {% for activity in recent_activities %}
                <div class="activity-item">
                    <div class="activity-icon {{ activity.icon_class }}">
                        <i class="{{ activity.icon }}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">{{ activity.title }}</div>
                        <div class="activity-time">{{ activity.time }}</div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-info-circle fa-2x mb-3" style="color: #7986cb;"></i>
                    <p>No recent activity</p>
                </div>
            {% endif %}
        </div>
    </div>

{% endblock %}

{% block script %}
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        Chart.defaults.color = '#c5cae9';
        Chart.defaults.borderColor = 'rgba(255,255,255,0.1)';

        // Dynamic data from backend
        const lotBookingsData = {
            labels: {{ lot_names | tojson | safe }},
            datasets: [{
                label: 'Bookings',
                data: {{ lot_bookings | tojson | safe }},
                backgroundColor: [
                    'rgba(255, 107, 107, 0.8)',
                    'rgba(255, 217, 61, 0.8)', 
                    'rgba(66, 165, 245, 0.8)',
                    'rgba(102, 187, 106, 0.8)',
                    'rgba(171, 71, 188, 0.8)'
                ],
                borderColor: [
                    'rgba(255, 107, 107, 1)',
                    'rgba(255, 217, 61, 1)',
                    'rgba(66, 165, 245, 1)',
                    'rgba(102, 187, 106, 1)',
                    'rgba(171, 71, 188, 1)'
                ],
                borderWidth: 2
            }]
        };

        const spotStatusData = {
            labels: ['Available', 'Occupied', 'Maintenance'],
            datasets: [{
                data: [
                    {{ spot_status.available }},
                    {{ spot_status.occupied }},
                    {{ spot_status.maintenance }}
                ],
                backgroundColor: [
                    'rgba(76, 175, 80, 0.8)',
                    'rgba(239, 83, 80, 0.8)',
                    'rgba(255, 152, 0, 0.8)'
                ],
                borderColor: [
                    'rgba(76, 175, 80, 1)',
                    'rgba(239, 83, 80, 1)',
                    'rgba(255, 152, 0, 1)'
                ],
                borderWidth: 2
            }]
        };

        const revenueData = {
            labels: {{ revenue_labels | tojson | safe }},
            datasets: [{
                label: 'Revenue ($)',
                data: {{ revenue_data | tojson | safe }},
                borderColor: 'rgba(63, 81, 181, 1)',
                backgroundColor: 'rgba(63, 81, 181, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        };

        // Initialize Charts
        const lotBookingsCtx = document.getElementById('lotBookingsChart').getContext('2d');
        new Chart(lotBookingsCtx, {
            type: 'bar',
            data: lotBookingsData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            }
        });

        const spotStatusCtx = document.getElementById('spotStatusChart').getContext('2d');
        new Chart(spotStatusCtx, {
            type: 'doughnut',
            data: spotStatusData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 20, font: { size: 12 } }
                    }
                }
            }
        });

        const revenueCtx = document.getElementById('revenueChart').getContext('2d');
        new Chart(revenueCtx, {
            type: 'line',
            data: revenueData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            }
        });



    </script>
{% endblock %}
